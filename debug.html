<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug - Cl√≠nica Flor√™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">üîç Debug - Sistema Cl√≠nica Flor√™</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Status dos Scripts -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">üì¶ Status dos Scripts</h2>
                <div id="script-status" class="space-y-2"></div>
            </div>

            <!-- Configura√ß√£o -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">‚öôÔ∏è Configura√ß√£o</h2>
                <div id="config-status" class="space-y-2"></div>
            </div>

            <!-- Teste de Conex√£o -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">üîå Teste de Conex√£o</h2>
                <button onclick="testConnection()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-2">
                    Testar Conex√£o Supabase
                </button>
                <button onclick="testSave()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4">
                    Testar Salvamento
                </button>
                <div id="connection-result"></div>
            </div>

            <!-- App Status -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">üöÄ Status da App</h2>
                <button onclick="loadApp()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 mb-4">
                    Carregar App Principal
                </button>
                <div id="app-status"></div>
            </div>
        </div>

        <!-- Log Console -->
        <div class="bg-gray-800 text-green-400 p-4 rounded-lg mt-8">
            <h3 class="text-lg font-semibold mb-2">üìù Console Log</h3>
            <div id="console-log" class="font-mono text-sm h-40 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-400';
            logDiv.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function checkStatus(name, condition, element) {
            const status = condition ? '‚úÖ' : '‚ùå';
            const color = condition ? 'text-green-600' : 'text-red-600';
            element.innerHTML += `<div class="${color}">${status} ${name}</div>`;
            return condition;
        }

        // Verificar status dos scripts
        function checkScripts() {
            const scriptDiv = document.getElementById('script-status');
            
            checkStatus('Tailwind CSS', typeof tailwind !== 'undefined', scriptDiv);
            checkStatus('Chart.js', typeof Chart !== 'undefined', scriptDiv);
            checkStatus('Supabase', typeof window.supabase !== 'undefined', scriptDiv);
            checkStatus('Config.js', typeof window.AppConfig !== 'undefined', scriptDiv);
        }

        // Verificar configura√ß√£o
        function checkConfig() {
            const configDiv = document.getElementById('config-status');
            
            if (window.AppConfig) {
                checkStatus('AppConfig carregado', true, configDiv);
                checkStatus('getSupabaseConfig', typeof window.AppConfig.getSupabaseConfig === 'function', configDiv);
                checkStatus('isDevelopment', typeof window.AppConfig.isDevelopment === 'function', configDiv);
                
                try {
                    const config = window.AppConfig.getSupabaseConfig();
                    checkStatus('URL configurada', !!config.url, configDiv);
                    checkStatus('Key configurada', !!config.key, configDiv);
                } catch (error) {
                    configDiv.innerHTML += `<div class="text-red-600">‚ùå Erro: ${error.message}</div>`;
                }
            } else {
                checkStatus('AppConfig', false, configDiv);
            }
        }

        // Testar conex√£o
        async function testConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = '<div class="text-yellow-600">üîÑ Testando...</div>';
            
            try {
                if (!window.AppConfig) {
                    throw new Error('AppConfig n√£o carregado');
                }

                const config = window.AppConfig.getSupabaseConfig();
                const supabase = window.supabase.createClient(config.url, config.key);
                
                log('üîå Testando conex√£o com Supabase...');
                
                const { data, error } = await supabase
                    .from('planos_acao')
                    .select('count')
                    .limit(1);

                if (error) throw error;

                resultDiv.innerHTML = '<div class="text-green-600">‚úÖ Conex√£o OK!</div>';
                log('‚úÖ Conex√£o com Supabase bem-sucedida!', 'success');
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Erro: ${error.message}</div>`;
                log(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
            }
        }

        // Testar salvamento
        async function testSave() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML += '<div class="text-yellow-600">üîÑ Testando salvamento...</div>';
            
            try {
                if (!window.AppConfig) {
                    throw new Error('AppConfig n√£o carregado');
                }

                const config = window.AppConfig.getSupabaseConfig();
                const supabase = window.supabase.createClient(config.url, config.key);
                
                log('üíæ Testando salvamento no Supabase...');
                
                // Dados de teste seguindo exatamente a estrutura da tabela
                const testData = {
                    nome_clinica: 'Cl√≠nica Flor√™',
                    nome_contato: 'M√¥nica',
                    servicos_foco: ['Harmoniza√ß√£o Facial', 'Botox', 'Teste'],
                    posicionamento_mercado: 'Volume',
                    diferencial: 'Teste de diferencial da cl√≠nica',
                    investimento_gestao: 300.00,
                    investimento_anuncios: 300.00,
                    checklist_status: { "c1": true, "c2": false, "c3": true },
                    gestor_nome: 'Marcelo Fruck',
                    gestor_contato: '(51) 99305-3612'
                };

                const { data, error } = await supabase
                    .from('planos_acao')
                    .insert([testData])
                    .select();

                if (error) throw error;

                resultDiv.innerHTML += '<div class="text-green-600">‚úÖ Salvamento OK!</div>';
                log(`‚úÖ Dados salvos com sucesso! ID: ${data[0]?.id}`, 'success');
                
            } catch (error) {
                resultDiv.innerHTML += `<div class="text-red-600">‚ùå Erro no salvamento: ${error.message}</div>`;
                log(`‚ùå Erro no salvamento: ${error.message}`, 'error');
            }
        }

        // Carregar app principal
        function loadApp() {
            const statusDiv = document.getElementById('app-status');
            statusDiv.innerHTML = '<div class="text-yellow-600">üîÑ Carregando app-secure.js...</div>';
            
            const script = document.createElement('script');
            script.src = 'app-secure.js';
            script.onload = () => {
                statusDiv.innerHTML = '<div class="text-green-600">‚úÖ App carregada!</div>';
                log('‚úÖ app-secure.js carregado com sucesso', 'success');
                
                // Verificar se a app foi instanciada
                setTimeout(() => {
                    if (window.clinicaApp) {
                        statusDiv.innerHTML += '<div class="text-green-600">‚úÖ ClinicaFloreApp instanciada!</div>';
                        log('‚úÖ ClinicaFloreApp instanciada com sucesso', 'success');
                    } else {
                        statusDiv.innerHTML += '<div class="text-red-600">‚ùå ClinicaFloreApp n√£o instanciada</div>';
                        log('‚ùå ClinicaFloreApp n√£o foi instanciada', 'error');
                    }
                }, 1000);
            };
            script.onerror = () => {
                statusDiv.innerHTML = '<div class="text-red-600">‚ùå Erro ao carregar app</div>';
                log('‚ùå Erro ao carregar app-secure.js', 'error');
            };
            document.head.appendChild(script);
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug iniciado');
            checkScripts();
            checkConfig();
        });
    </script>
</body>
</html> 